<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Votación en Tiempo Real</title>
<style>
    body{
        background: slategray;
        font-family: calibri;
        text-align: center;
        padding: 0;
        margin: 0;
        font-size: 120%;
    }
    .contenedor{
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        height: 100vh;
    }
    .btn{
        width: 200px;
        padding: 15px;
        margin: 10px;
        font-size: 1.2em;
        border: none;
        border-radius: 10px;
        cursor: pointer;
        transition: transform 0.2s;
    }
    .btn:hover{ transform: scale(1.05); }
    .opcionA{ background: #87CEEB; } /* Celeste */
    .opcionB{ background: #FFB6C1; } /* Rosado claro */
    #resultado{
        background: white;
        padding: 20px;
        margin-top: 20px;
        width: 60%;
        max-width: 400px;
        border-radius: 10px;
    }
    #ganador{
        margin-top: 10px;
        font-weight: bold;
        font-size: 1.3em;
    }
</style>
</head>
<body>

<div class="contenedor">
    <h2>¿Qué sistema gestor de base de datos es mejor?</h2>
    <button class="btn opcionA" onclick="votar('A')">SQL Server</button>
    <button class="btn opcionB" onclick="votar('B')">PostgreSQL</button>

    <div id="resultado" style="display:none;">
        <h3>Resultados:</h3>
        <p id="votosA"></p>
        <p id="votosB"></p>
        <div id="ganador"></div>
    </div>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
  // ======= CONFIGURACIÓN DE FIREBASE =======
  // REEMPLAZA ESTOS DATOS CON LOS DE TU PROYECTO FIREBASE
  const firebaseConfig = {
    apiKey: "AIzaSyDexample...", // Tu apiKey real
    authDomain: "votacion-online.firebaseapp.com",
    databaseURL: "https://votacion-online-default-rtdb.firebaseio.com",
    projectId: "votacion-online",
    storageBucket: "votacion-online.appspot.com",
    messagingSenderId: "123456789", // Tu senderId real
    appId: "1:123456789:web:abc123..." // Tu appId real
  };

  // Inicializar Firebase
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  // ======= VARIABLES =======
  let votos = {A:0, B:0};

  // ======= VERIFICAR SI YA VOTÓ Y MOSTRAR RESULTADOS =======
  function inicializarApp() {
      if(localStorage.getItem('yaVoto')) {
          mostrarResultados();
      }
      
      // Cargar resultados actuales
      cargarResultados();
  }

  // ======= FUNCIONES =======
  function votar(opcion){
      if(localStorage.getItem('yaVoto')){
          alert("Ya has votado.");
          mostrarResultados();
          return;
      }

      console.log("Votando por opción:", opcion);
      
      // Guardar voto en Firebase
      const votoRef = db.ref('votos/' + opcion);
      votoRef.transaction(current => {
          return (current || 0) + 1;
      }).then(() => {
          console.log("Voto registrado correctamente");
          // Marcar que ya votó
          localStorage.setItem('yaVoto','1');
          mostrarResultados();
      }).catch(error => {
          console.error("Error al votar:", error);
          alert("Error al registrar el voto: " + error.message);
      });
  }

  // ======= CARGAR Y MOSTRAR RESULTADOS =======
  function cargarResultados() {
      db.ref('votos').on('value', snapshot => {
          const datos = snapshot.val();
          console.log("Datos recibidos de Firebase:", datos);
          
          votos = datos || {A:0, B:0};
          actualizarInterfaz();
      }, error => {
          console.error("Error al cargar resultados:", error);
      });
  }

  function mostrarResultados(){
      document.getElementById("resultado").style.display = "block";
  }

  function actualizarInterfaz() {
      mostrarResultados();
      document.getElementById("votosA").innerText = `SQL Server: ${votos.A || 0} votos`;
      document.getElementById("votosB").innerText = `PostgreSQL: ${votos.B || 0} votos`;

      let ganador;
      if((votos.A || 0) > (votos.B || 0)) {
          ganador = "¡SQL Server gana!";
      } else if((votos.B || 0) > (votos.A || 0)) {
          ganador = "¡PostgreSQL gana!";
      } else {
          ganador = "¡Empate!";
      }
      document.getElementById("ganador").innerText = ganador;
  }

  // ======= INICIALIZAR LA APLICACIÓN =======
  document.addEventListener('DOMContentLoaded', inicializarApp);
</script>

</body>
</html>
